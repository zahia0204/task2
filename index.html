<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Moyenne Semestre</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #ffe6f0;
    margin: 0;
    padding: 15px;
}

h1 {
    text-align: center;
    color: #c2185b;
}

.module {
    background: white;
    border-radius: 12px;
    padding: 12px;
    margin-bottom: 15px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

.module h2 {
    margin: 0 0 8px;
    color: #d81b60;
    font-size: 18px;
}

.inputs {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

input {
    flex: 1;
    padding: 10px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #ccc;
}

input.error {
    border: 2px solid red;
    background: #ffecec;
}

.final {
    margin-top: 8px;
    font-weight: bold;
}

.green { color: green; }
.red { color: red; }

button {
    width: 100%;
    padding: 14px;
    font-size: 18px;
    border: none;
    border-radius: 12px;
    background: #d81b60;
    color: white;
    cursor: pointer;
}

button:hover {
    background: #c2185b;
}

#result {
    text-align: center;
    margin-top: 15px;
    font-size: 20px;
    font-weight: bold;
}

/* Popup */
.popup {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 999;
}

.popup.hidden {
    display: none;
}

.popup-box {
    background: white;
    padding: 20px;
    border-radius: 16px;
    text-align: center;
    width: 80%;
    max-width: 300px;
}

.popup-box p {
    font-size: 16px;
    color: #d81b60;
    margin-bottom: 15px;
}

.popup-box button {
    background: #d81b60;
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 10px;
    font-size: 16px;
}

footer {
    text-align: center;
    margin-top: 25px;
    padding: 12px;
    font-size: 14px;
    color: #c2185b;
    font-style: italic;
}
</style>
</head>

<body>

<h1>Moyenne du semestre</h1>

<!-- MODULES -->
<!-- Algo -->
<div class="module">
<h2>Algo (coef 3)</h2>
<div class="inputs">
<input id="algo_tp" placeholder="TP" type="number" min="0" max="20" step="0.01">
<input id="algo_td" placeholder="TD" type="number" min="0" max="20" step="0.01">
<input id="algo_exam" placeholder="Exam" type="number" min="0" max="20" step="0.01">
</div>
<div id="algo_final" class="final"></div>
</div>

<!-- Réseaux -->
<div class="module">
<h2>Réseaux (coef 3)</h2>
<div class="inputs">
<input id="net_tp" placeholder="TP" type="number" min="0" max="20" step="0.01">
<input id="net_td" placeholder="TD" type="number" min="0" max="20" step="0.01">
<input id="net_exam" placeholder="Exam" type="number" min="0" max="20" step="0.01">
</div>
<div id="net_final" class="final"></div>
</div>

<!-- ABD -->
<div class="module">
<h2>ABD (coef 3)</h2>
<div class="inputs">
<input id="abd_tp" placeholder="TP" type="number" min="0" max="20" step="0.01">
<input id="abd_td" placeholder="TD" type="number" min="0" max="20" step="0.01">
<input id="abd_exam" placeholder="Exam" type="number" min="0" max="20" step="0.01">
</div>
<div id="abd_final" class="final"></div>
</div>

<!-- Crypto -->
<div class="module">
<h2>Crypto (coef 3)</h2>
<div class="inputs">
<input id="crypto_tp" placeholder="TP" type="number" min="0" max="20" step="0.01">
<input id="crypto_td" placeholder="TD" type="number" min="0" max="20" step="0.01">
<input id="crypto_exam" placeholder="Exam" type="number" min="0" max="20" step="0.01">
</div>
<div id="crypto_final" class="final"></div>
</div>

<!-- RO -->
<div class="module">
<h2>RO (coef 1)</h2>
<div class="inputs">
<input id="ro_exam" placeholder="Exam" type="number" min="0" max="20" step="0.01">
</div>
<div id="ro_final" class="final"></div>
</div>

<!-- C++ -->
<div class="module">
<h2>C++ (coef 2)</h2>
<div class="inputs">
<input id="cpp_tp" placeholder="TP" type="number" min="0" max="20" step="0.01">
<input id="cpp_exam" placeholder="Exam" type="number" min="0" max="20" step="0.01">
</div>
<div id="cpp_final" class="final"></div>
</div>

<!-- AI -->
<div class="module">
<h2>AI (coef 1)</h2>
<div class="inputs">
<input id="ai_exam" placeholder="Exam" type="number" min="0" max="20" step="0.01">
</div>
<div id="ai_final" class="final"></div>
</div>

<!-- Cyber -->
<div class="module">
<h2>Cybercriminalité (coef 1)</h2>
<div class="inputs">
<input id="cyber_exam" placeholder="Exam" type="number" min="0" max="20" step="0.01">
</div>
<div id="cyber_final" class="final"></div>
</div>

<button type="button" onclick="calculate()">Calculer</button>

<div id="result"></div>

<!-- POPUP -->
<div id="popup" class="popup hidden">
  <div class="popup-box">
    <p id="popupMsg"></p>
    <button onclick="closePopup()">OK</button>
  </div>
</div>

<script>
// SIMPLIFIED VALIDATION - WORKING VERSION
function getValue(id) {
    const element = document.getElementById(id);
    if (!element) return 0;
    const value = element.value.trim();
    if (value === '') return 0;
    return parseFloat(value.replace(",", ".")) || 0;
}

function validateInput(input) {
    const value = input.value.trim();
    if (value === '') {
        input.classList.remove("error");
        return true; // Allow empty
    }
    
    const num = parseFloat(value.replace(",", "."));
    if (isNaN(num) || num < 0 || num > 20) {
        input.classList.add("error");
        input.value = '';
        return false;
    }
    
    input.classList.remove("error");
    return true;
}

function showPopup(msg) {
    document.getElementById("popupMsg").textContent = msg;
    document.getElementById("popup").classList.remove("hidden");
}

function closePopup() {
    document.getElementById("popup").classList.add("hidden");
}

function setFinal(id, note) {
    const el = document.getElementById(id);
    if (!el) return;
    el.textContent = "Note finale : " + note.toFixed(2);
    el.className = "final " + (note >= 10 ? "green" : "red");
}

// SIMPLE CHECK - Only validate that Exam fields are filled
function validateExamFields() {
    const examFields = [
        'algo_exam', 'net_exam', 'abd_exam', 'crypto_exam',
        'ro_exam', 'cpp_exam', 'ai_exam', 'cyber_exam'
    ];
    
    let allValid = true;
    
    examFields.forEach(fieldId => {
        const input = document.getElementById(fieldId);
        if (input) {
            const value = input.value.trim();
            if (value === '') {
                input.classList.add('error');
                allValid = false;
            } else {
                const num = parseFloat(value.replace(',', '.'));
                if (isNaN(num) || num < 0 || num > 20) {
                    input.classList.add('error');
                    allValid = false;
                } else {
                    input.classList.remove('error');
                }
            }
        }
    });
    
    return allValid;
}

function calculate() {
    console.log('Calculate function called');
    
    // Clear all errors first
    document.querySelectorAll('input').forEach(input => {
        input.classList.remove('error');
    });
    
    // Only validate Exam fields (most important)
    if (!validateExamFields()) {
        showPopup("⚠️ Veuillez remplir toutes les notes d'Exam (entre 0 et 20)");
        return;
    }
    
    try {
        let sum = 0, coef = 0;

        // Algo - All fields required for calculation
        let algo_tp = getValue("algo_tp");
        let algo_td = getValue("algo_td");
        let algo_exam = getValue("algo_exam");
        let algo = 0.2 * algo_tp + 0.2 * algo_td + 0.6 * algo_exam;
        setFinal("algo_final", algo);
        sum += algo * 3;
        coef += 3;

        // Réseaux
        let net_tp = getValue("net_tp");
        let net_td = getValue("net_td");
        let net_exam = getValue("net_exam");
        let net = 0.2 * net_tp + 0.2 * net_td + 0.6 * net_exam;
        setFinal("net_final", net);
        sum += net * 3;
        coef += 3;

        // ABD
        let abd_tp = getValue("abd_tp");
        let abd_td = getValue("abd_td");
        let abd_exam = getValue("abd_exam");
        let abd = 0.2 * abd_tp + 0.2 * abd_td + 0.6 * abd_exam;
        setFinal("abd_final", abd);
        sum += abd * 3;
        coef += 3;

        // Crypto
        let crypto_tp = getValue("crypto_tp");
        let crypto_td = getValue("crypto_td");
        let crypto_exam = getValue("crypto_exam");
        let crypto = 0.2 * crypto_tp + 0.2 * crypto_td + 0.6 * crypto_exam;
        setFinal("crypto_final", crypto);
        sum += crypto * 3;
        coef += 3;

        // RO
        let ro = getValue("ro_exam");
        setFinal("ro_final", ro);
        sum += ro;
        coef += 1;

        // C++
        let cpp_tp = getValue("cpp_tp");
        let cpp_exam = getValue("cpp_exam");
        let cpp = 0.4 * cpp_tp + 0.6 * cpp_exam;
        setFinal("cpp_final", cpp);
        sum += cpp * 2;
        coef += 2;

        // AI
        let ai = getValue("ai_exam");
        setFinal("ai_final", ai);
        sum += ai;
        coef += 1;

        // Cyber
        let cyber = getValue("cyber_exam");
        setFinal("cyber_final", cyber);
        sum += cyber;
        coef += 1;

        // Calculate final average
        const moyenne = coef > 0 ? sum / coef : 0;
        const resultDiv = document.getElementById("result");
        resultDiv.textContent = "Moyenne du semestre : " + moyenne.toFixed(2);
        resultDiv.style.color = moyenne >= 10 ? "green" : "red";
        
        console.log('Calculation complete. Average:', moyenne.toFixed(2));
        
    } catch (error) {
        console.error('Error in calculation:', error);
        showPopup("Erreur de calcul: " + error.message);
    }
}

// Add input validation on blur
document.querySelectorAll('input').forEach(input => {
    input.addEventListener('blur', function() {
        validateInput(this);
    });
    
    input.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            validateInput(this);
            
            // Move to next input or calculate
            const inputs = Array.from(document.querySelectorAll('input'));
            const index = inputs.indexOf(this);
            if (index < inputs.length - 1) {
                inputs[index + 1].focus();
            } else {
                calculate();
            }
        }
    });
});

// Initialize
console.log('Grade calculator ready');
</script>

<footer>
next semester ndirlkom update XD stay tuned
</footer>

</body>
</html>
